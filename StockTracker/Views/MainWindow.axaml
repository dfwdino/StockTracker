<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:StockTracker.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="300" d:DesignHeight="800"
        x:Class="StockTracker.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Title="Stock Tracker"
        MinWidth="1200" MinHeight="600" Width="1400" Height="600">

	<Design.DataContext>
		<vm:MainWindowViewModel/>
	</Design.DataContext>

	<Grid>
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="*"/>
			<RowDefinition Height="Auto"/>
		</Grid.RowDefinitions>

		<!-- Header -->
		<Border Grid.Row="0" Background="#2196F3" Padding="20">
			<StackPanel>
				<TextBlock Text="Stock Tracker" FontSize="28" FontWeight="Bold"
						   Foreground="White" HorizontalAlignment="Center"/>
				<TextBlock Text="Track your stock investments and performance" FontSize="14"
						   Foreground="White" HorizontalAlignment="Center" Margin="0,5,0,0"/>
			</StackPanel>
		</Border>

		<!-- Add Purchase Form -->
		<Border Grid.Row="1" Background="#F5F5F5" Padding="15" Margin="0,0,0,10">
			<Grid ColumnDefinitions="Auto,auto,Auto,auto,Auto,100,Auto,auto,auto,*,*" RowDefinitions="Auto,Auto">

				<TextBlock Grid.Row="0" Grid.Column="0" Text="Add Purchase:" FontWeight="Bold"
						   MinWidth="100" VerticalAlignment="Center"  Margin="0,0,10,0"/>

				<TextBox Grid.Row="0" Grid.Column="1" Text="{Binding NewSymbol}"
						  Watermark="Symbol (e.g., AAPL)"  Margin="0,0,10,0"/>

				<TextBlock Grid.Row="0" Grid.Column="2" Text="Price:" VerticalAlignment="Center"
						   Margin="0,0,10,0"/>

				<TextBox Grid.Row="0" Grid.Column="3" Text="{Binding NewPrice}"
						  Watermark="0.00" Margin="0,0,10,0"/>

				<TextBlock Grid.Row="0" Grid.Column="4" Text="Quantity:" VerticalAlignment="Center"
						    Margin="0,0,10,0"/>

				<TextBox Grid.Row="0" Grid.Column="5" Text="{Binding NewQuantity}"
						Watermark="1" Margin="0,0,10,0"/>

				<TextBlock Grid.Row="0" Grid.Column="6" Text="Date:" VerticalAlignment="Center"
						   Margin="0,0,10,0"/>

				<DatePicker Grid.Row="0" Grid.Column="7" SelectedDate="{Binding NewPurchaseDate}"
					 MinWidth="300" Margin="0,0,10,0"/>

				<CheckBox Grid.Row="0"
				 Grid.Column="8"
				 Content="Dividend"
				 IsChecked="{Binding IsDividend}"
						  VerticalAlignment="Center"
				 Margin="0,0,10,0"/>

				<StackPanel Grid.Row="0" Grid.Column="9" Orientation="Horizontal"
							HorizontalAlignment="Right">
					<Button Content="Add Purchase" Command="{Binding AddPurchaseCommand}"
							Classes="accent" Margin="0,0,10,0"/>
					<Button Content="Refresh All" Command="{Binding RefreshAllPricesCommand}"
							Classes="outline"/>
				</StackPanel>

				<!-- Status Message -->
				<TextBlock Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="9"
						   Text="{Binding StatusMessage}" FontStyle="Italic"
						   Margin="0,10,0,0" Foreground="#666"/>
			</Grid>
		</Border>

		<!-- Loading Indicator -->
		<ProgressBar Grid.Row="2" IsIndeterminate="{Binding IsLoading}"
					 IsVisible="{Binding IsLoading}" Height="4" Margin="0,10"/>

		<!-- Stocks List -->
		<ScrollViewer Grid.Row="2" Margin="10,0">
			<ItemsControl ItemsSource="{Binding Stocks}">
				<ItemsControl.ItemTemplate>
					<DataTemplate>
						<Border Background="White" BorderBrush="#E0E0E0" BorderThickness="1"
								CornerRadius="8" Margin="0,0,0,10" Padding="20">
							<Grid ColumnDefinitions="Auto,*,Auto" RowDefinitions="Auto,Auto,Auto">

								<!-- Stock Symbol and Current Price -->
								<StackPanel Grid.Row="0" Grid.Column="0">
									<TextBlock Text="{Binding Symbol}" FontSize="24" FontWeight="Bold"
											   Foreground="#2196F3"/>
									<TextBlock Text="{Binding CurrentPriceFormatted}" FontSize="18"
											   FontWeight="SemiBold" Margin="0,5,0,0"/>
									<TextBlock Text="Last updated: " FontSize="10" Foreground="#666"/>
									<TextBlock Text="{Binding LastUpdatedFormatted}" FontSize="10"
											   Foreground="#666"/>
								</StackPanel>

								<!-- Performance Summary -->
								<StackPanel Grid.Row="0" Grid.Column="1" Margin="20,0">
									<Grid ColumnDefinitions="Auto,auto,Auto,auto,auto, auto" RowDefinitions="Auto,Auto,Auto,Auto">

										
										<TextBlock Grid.Row="0" Grid.Column="0" Text="Total Investment:"
												   FontWeight="SemiBold" Margin="0,0,10,5"/>
										<TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding TotalInvestmentFormatted}"
												   Margin="0,0,20,5"/>
										
										<TextBlock Grid.Row="0" Grid.Column="2" Text="Current Value:"
												   FontWeight="SemiBold" Margin="0,0,10,5"/>
										<TextBlock Grid.Row="0" Grid.Column="3" Text="{Binding CurrentValueFormatted}"
												   Margin="0,0,0,5"/>

										<TextBlock Grid.Row="1" Grid.Column="0" Text="Total Gain/Loss:"
												   FontWeight="SemiBold" Margin="0,0,10,5"/>
										<TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding TotalGainLossFormatted}"
												   Foreground="{Binding TotalGainLossColor}" FontWeight="SemiBold"
												   Margin="0,0,20,5"/>
										
										<TextBlock Grid.Row="1" Grid.Column="2" Text="Percentage:"
												   FontWeight="SemiBold" Margin="0,0,10,5"/>
										<TextBlock Grid.Row="1" Grid.Column="3" Text="{Binding TotalGainLossPercentageFormatted}"
												   Foreground="{Binding TotalGainLossColor}" FontWeight="SemiBold"
												   Margin="0,0,0,5"/>

										<TextBlock Grid.Row="2" Grid.Column="0" Text="Latest Purchase Gain/Loss:"
												   FontWeight="SemiBold" Margin="0,0,10,5"/>
										<TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding LatestPurchaseGainLossFormatted}"
												   Foreground="{Binding LatestPurchaseGainLossColor}" FontWeight="SemiBold"
												   Margin="0,0,20,5"/>
										
										<TextBlock Grid.Row="2" Grid.Column="2" Text="Percentage:"
												   FontWeight="SemiBold" Margin="0,0,10,5"/>
										<TextBlock Grid.Row="2" Grid.Column="3" Text="{Binding LatestPurchaseGainLossPercentageFormatted}"
												   Foreground="{Binding LatestPurchaseGainLossColor}" FontWeight="SemiBold"
												   Margin="0,0,20,5"/>

										<TextBlock Grid.Row="3" Grid.Column="2" Text="Div:"
												   FontWeight="SemiBold" Margin="0,0,10,5"/>
										<TextBlock Grid.Row="3" Grid.Column="3" Text="{Binding LatestDivTotalFormatted}"
												   Foreground="{Binding LatestDivTotalFormatted}" FontWeight="SemiBold"
												   Margin="0,0,20,5"/>

										<TextBlock Grid.Row="0" Grid.Column="4" Text="Total Bought:"
												   FontWeight="SemiBold" Margin="0,0,10,5"/>
										<TextBlock Grid.Row="0" Grid.Column="5" Text="{Binding TotalBought}"
												   Foreground="{Binding TotalBought}" FontWeight="SemiBold"
												   Margin="0,0,20,5"/>

										<TextBlock Grid.Row="1" Grid.Column="4" Text="Bought Max"
												   FontWeight="SemiBold" Margin="0,0,10,5"/>
										<TextBlock Grid.Row="1" Grid.Column="5" Text="{Binding BoughtMax}"
												   Foreground="{Binding TotalBought}" FontWeight="SemiBold"
												   Margin="0,0,20,5"/>

										<TextBlock Grid.Row="2" Grid.Column="4" Text="Bought Min"
												   FontWeight="SemiBold" Margin="0,0,10,5"/>
										<TextBlock Grid.Row="2" Grid.Column="5" Text="{Binding BoughtMin}"
												   Foreground="{Binding TotalBought}" FontWeight="SemiBold"
												   Margin="0,0,20,5"/>

										<TextBlock Grid.Row="3" Grid.Column="4" Text="Div Max/Min"
												   FontWeight="SemiBold" Margin="0,0,10,5"/>
										<TextBlock Grid.Row="3" Grid.Column="5" Text="{Binding DivMaxMin}"
												   Foreground="{Binding TotalBought}" FontWeight="SemiBold"
												   Margin="0,0,20,5"/>

										<TextBlock Grid.Row="3" Grid.Column="0" Text="Total Shares:"
												   FontWeight="SemiBold" Margin="0,0,10,0"/>
										<TextBlock Grid.Row="3" Grid.Column="1" Text="{Binding TotalShares}"
												   Margin="0,0,0,0"/>
									</Grid>
								</StackPanel>

								<!-- Action Buttons -->
								<StackPanel Grid.Row="0" Grid.Column="2" Orientation="Vertical"
											HorizontalAlignment="Right">
									<Button Content="Refresh Price" Command="{Binding RefreshPriceCommand}"
											Classes="outline" Margin="0,0,0,10" Width="120"/>
									<Button Content="Delete Stock"
											Command="{Binding DataContext.DeleteStockCommand, RelativeSource={RelativeSource AncestorType=Window}}"
											CommandParameter="{Binding}"
											Classes="danger" Width="120"/>
								</StackPanel>

								<!-- Purchases List -->
								<Border Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="4"
										Background="#F9F9F9" BorderBrush="#E0E0E0" BorderThickness="1"
										CornerRadius="4" Margin="0,15,0,0" Padding="15">
									<StackPanel>

										<Grid ColumnDefinitions="Auto,auto,Auto,Auto,Auto">
											<TextBlock Grid.Column="0" Text="Purchase History" FontWeight="Bold" Width="125"/>
											<TextBlock Grid.Column="1" Text="Quantity" FontWeight="Bold" TextAlignment="Center" Width="125"/>
											<TextBlock Grid.Column="2" Text="Price Per Share" FontWeight="Bold" Width="125" TextAlignment="Center"/>
											<TextBlock Grid.Column="3" Text="Total Cost" TextAlignment="Center" FontWeight="Bold" Width="125"/>
											<TextBlock Grid.Column="4" Text="Is Div" TextAlignment="Center" FontWeight="Bold" Width="125"/>
										</Grid>


										<ItemsControl ItemsSource="{Binding Purchases}">
											<ItemsControl.ItemTemplate>
												<DataTemplate>
													<Border Padding="5" Margin="0,0,0,5">
														<Grid ColumnDefinitions="Auto,auto,Auto,Auto,Auto">
															<TextBlock Grid.Column="0" Text="{Binding PurchaseDateFormatted}"
																	   FontWeight="SemiBold" Width="125"/>
															<TextBlock Grid.Column="1" Text="{Binding QuantityFormatted}"
																	   TextAlignment="Center" Width="125"/>
															<TextBlock Grid.Column="2" Text="{Binding PricePerShareFormatted}"
																	   TextAlignment="Center" Width="125"/>
															<TextBlock Grid.Column="3" Text="{Binding TotalCostFormatted}"
																	   TextAlignment="Center" FontWeight="SemiBold" Width="125"/>

															<Panel Grid.Column="4" Width="125" HorizontalAlignment="Stretch">
																<CheckBox IsEnabled="False" IsChecked="{Binding IsDividend}"
																		  HorizontalAlignment="Center"
																		  VerticalAlignment="Center"/>
															</Panel>
														</Grid>
													</Border>
												</DataTemplate>
											</ItemsControl.ItemTemplate>
										</ItemsControl>
									</StackPanel>
								</Border>
							</Grid>
						</Border>
					</DataTemplate>
				</ItemsControl.ItemTemplate>
			</ItemsControl>
		</ScrollViewer>

		<!-- Footer -->
		<Border Grid.Row="3" Background="#F5F5F5" Padding="10">
			<TextBlock Text="Stock data provided by Alpha Vantage API"
					   FontSize="12" Foreground="#666" HorizontalAlignment="Center"/>
		</Border>
	</Grid>

	<Window.Styles>
		<Style Selector="Button.accent">
			<Setter Property="Background" Value="#2196F3"/>
			<Setter Property="Foreground" Value="White"/>
			<Setter Property="BorderThickness" Value="0"/>
			<Setter Property="Padding" Value="15,8"/>
			<Setter Property="CornerRadius" Value="4"/>
		</Style>

		<Style Selector="Button.outline">
			<Setter Property="Background" Value="Transparent"/>
			<Setter Property="Foreground" Value="#2196F3"/>
			<Setter Property="BorderBrush" Value="#2196F3"/>
			<Setter Property="BorderThickness" Value="1"/>
			<Setter Property="Padding" Value="15,8"/>
			<Setter Property="CornerRadius" Value="4"/>
		</Style>

		<Style Selector="Button.danger">
			<Setter Property="Background" Value="Transparent"/>
			<Setter Property="Foreground" Value="#F44336"/>
			<Setter Property="BorderBrush" Value="#F44336"/>
			<Setter Property="BorderThickness" Value="1"/>
			<Setter Property="Padding" Value="15,8"/>
			<Setter Property="CornerRadius" Value="4"/>
		</Style>
	</Window.Styles>
</Window>
